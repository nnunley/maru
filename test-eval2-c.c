## defn main
main

emit: illegal instruction: (TEXT)
[31;1merror: aborted[m
[32m[?7lboot.l:24   [0m (abort)
[?7h[32m[?7lcore/compiler/emit.l:70[0m (error "aborted")
[?7h[32m[?7lboot.l:707             [0m (apply default arguments)
[?7h[32m[?7lboot.l:706             [0m (Fixed<if> default (apply default arguments) (error "no method in " (oop-at (%typecheck <generic> self) 0) " corresponding to " arguments))
[?7h[32m[?7lboot.l:705             [0m (Fixed<let> ((default (oop-at (%typecheck <generic> self) 2))) (Fixed<if> default (apply default arguments) (error "no method in " (oop-at (%typecheck <generic> self) 0) " corresponding to " arguments)))
[?7h[32m[?7lboot.l:703             [0m (Fixed<if> (Fixed<and> method (not (array? method))) (apply method arguments) (Fixed<let> ((default (oop-at (%typecheck <generic> self) 2))) (Fixed<if> default (apply default arguments) (error "no method in " (oop-at (%typecheck <generic> self) 0) " corresponding to " arguments))))
[?7h[32m[?7lboot.l:698             [0m (Fixed<let> ((method (oop-at (%typecheck <generic> self) 1)) (arg arguments)) (Fixed<while> arg (Fixed<set> method (array-at method (type-of (car arg)))) (Fixed<set> arg (cdr arg))) (Fixed<if> (Fixed<and> method (not (array? method))) (apply method arguments) (Fixed<let> ((default (oop-at (%typecheck <generic> self) 2))) (Fixed<if> default (apply default arguments) (error "no method in " (oop-at (%typecheck <generic> self) 0) " corresponding to " arguments)))))
[?7h[32m[?7lcore/compiler/emit.l:685[0m (emit TEXT)
[?7h[32m[?7lcore/compiler/emit.l:680[0m (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8)))
[?7h[32m[?7lcore/compiler/emit.l:680[0m (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))
[?7h[32m[?7lcore/compiler/emit.l:680[0m (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8)))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT)))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT))))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT)))))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((body (cddr defn))) (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT))))))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((body (cddr defn))) (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT)))))))))
[?7h[32m[?7lcore/compiler/emit.l:672[0m (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((body (cddr defn))) (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT))))))))))
[?7h[32m[?7lcore/compiler/emit.l:627[0m (Fixed<if> (= *emit-backend* (Fixed<quote> c)) (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((params (cadr defn))) (Fixed<let> ((body (cddr defn))) (set-oop-at (%typecheck <c-generator> *c-gen*) 5 name) (print "static oop " (mangle-label name) "(") (Fixed<let> ((first 1)) (Fixed<let> ((_list_ params)) (Fixed<while> _list_ (Fixed<let> ((param (car _list_))) (Fixed<if> first (Fixed<set> first ()) (print ", ")) (print "oop " (mangle-label (oop-at (%typecheck <variable> param) 0)))) (Fixed<set> _list_ (cdr _list_))))) (Fixed<if> (= 0 (list-length params)) (print "void")) (println ")") (println "{") (set-oop-at (%typecheck <c-generator> *c-gen*) 0 (+ (oop-at (%typecheck <c-generator> *c-gen*) 0) 1)) (c-indent) (print "return ") (c-gen-expr (car body)) (println ";") (set-oop-at (%typecheck <c-generator> *c-gen*) 0 (- (oop-at (%typecheck <c-generator> *c-gen*) 0) 1)) (println "}") (println) (set-oop-at (%typecheck <c-generator> *c-gen*) 2 (cons name (oop-at (%typecheck <c-generator> *c-gen*) 2))) (Fixed<or> main (Fixed<let> () (println "static oop v_" (mangle-label name) " = (oop)" (mangle-label name) ";") (set-oop-at (%typecheck <c-generator> *c-gen*) 3 (cons name (oop-at (%typecheck <c-generator> *c-gen*) 3))))))))) (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((body (cddr defn))) (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT)))))))))))
[?7h[32m[?7l...                     [0m (Fixed<let> () (Fixed<if> (= *emit-backend* (Fixed<quote> c)) (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((params (cadr defn))) (Fixed<let> ((body (cddr defn))) (set-oop-at (%typecheck <c-generator> *c-gen*) 5 name) (print "static oop " (mangle-label name) "(") (Fixed<let> ((first 1)) (Fixed<let> ((_list_ params)) (Fixed<while> _list_ (Fixed<let> ((param (car _list_))) (Fixed<if> first (Fixed<set> first ()) (print ", ")) (print "oop " (mangle-label (oop-at (%typecheck <variable> param) 0)))) (Fixed<set> _list_ (cdr _list_))))) (Fixed<if> (= 0 (list-length params)) (print "void")) (println ")") (println "{") (set-oop-at (%typecheck <c-generator> *c-gen*) 0 (+ (oop-at (%typecheck <c-generator> *c-gen*) 0) 1)) (c-indent) (print "return ") (c-gen-expr (car body)) (println ";") (set-oop-at (%typecheck <c-generator> *c-gen*) 0 (- (oop-at (%typecheck <c-generator> *c-gen*) 0) 1)) (println "}") (println) (set-oop-at (%typecheck <c-generator> *c-gen*) 2 (cons name (oop-at (%typecheck <c-generator> *c-gen*) 2))) (Fixed<or> main (Fixed<let> () (println "static oop v_" (mangle-label name) " = (oop)" (mangle-label name) ";") (set-oop-at (%typecheck <c-generator> *c-gen*) 3 (cons name (oop-at (%typecheck <c-generator> *c-gen*) 3))))))))) (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((body (cddr defn))) (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT))))))))))))
[?7h[32m[?7l...                     [0m (Fixed<let> () (Fixed<let> () (Fixed<if> (= *emit-backend* (Fixed<quote> c)) (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((params (cadr defn))) (Fixed<let> ((body (cddr defn))) (set-oop-at (%typecheck <c-generator> *c-gen*) 5 name) (print "static oop " (mangle-label name) "(") (Fixed<let> ((first 1)) (Fixed<let> ((_list_ params)) (Fixed<while> _list_ (Fixed<let> ((param (car _list_))) (Fixed<if> first (Fixed<set> first ()) (print ", ")) (print "oop " (mangle-label (oop-at (%typecheck <variable> param) 0)))) (Fixed<set> _list_ (cdr _list_))))) (Fixed<if> (= 0 (list-length params)) (print "void")) (println ")") (println "{") (set-oop-at (%typecheck <c-generator> *c-gen*) 0 (+ (oop-at (%typecheck <c-generator> *c-gen*) 0) 1)) (c-indent) (print "return ") (c-gen-expr (car body)) (println ";") (set-oop-at (%typecheck <c-generator> *c-gen*) 0 (- (oop-at (%typecheck <c-generator> *c-gen*) 0) 1)) (println "}") (println) (set-oop-at (%typecheck <c-generator> *c-gen*) 2 (cons name (oop-at (%typecheck <c-generator> *c-gen*) 2))) (Fixed<or> main (Fixed<let> () (println "static oop v_" (mangle-label name) " = (oop)" (mangle-label name) ";") (set-oop-at (%typecheck <c-generator> *c-gen*) 3 (cons name (oop-at (%typecheck <c-generator> *c-gen*) 3))))))))) (Fixed<let> ((main (= (Fixed<quote> main) name))) (Fixed<let> ((defn (oop-at (%typecheck <expr> self) 1))) (Fixed<let> ((body (cddr defn))) (Fixed<let> ((comp (compiler (+ 1 (oop-at (%typecheck <compiler> ocomp) 0))))) (Fixed<let> ((tnam (Fixed<if> main (LABEL name) (LABEL (temp-label-name))))) (Fixed<let> ((vnam (Fixed<if> main () (LABEL name)))) (Fixed<let> ((params (map-with gen-param (cadr defn) comp))) (Fixed<let> ((_list_ body)) (Fixed<while> _list_ (Fixed<let> ((e (car _list_))) (gen e comp)) (Fixed<set> _list_ (cdr _list_)))) (Fixed<let> ((arg-size (align 16 (oop-at (%typecheck <compiler> comp) 3)))) (Fixed<let> ((tmp-size (align 16 (+ arg-size (oop-at (%typecheck <compiler> comp) 5))))) (Fixed<let> ((frm-size (align 16 (+ tmp-size 8)))) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ arg-size (oop-at (%typecheck <TI32> tmp) 0)))) (oop-at (%typecheck <compiler> comp) 6)) (map (Fixed<lambda> (tmp) (set-oop-at (%typecheck <TI32> tmp) 0 (+ frm-size (oop-at (%typecheck <TI32> tmp) 0)))) params) (emit TEXT) (Fixed<and> main (emit GLOBAL tnam)) (emit DEFLABEL tnam) (emit COMMENT (list "frame " arg-size " " (oop-at (%typecheck <compiler> comp) 5) " " tmp-size " " frm-size)) (emit ENTER (- frm-size 8)) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))) (Fixed<and> (oop-at (%typecheck <compiler> comp) 7) (emit DEFLABEL (oop-at (%typecheck <compiler> comp) 7))) (emit LEAVE (- frm-size 8))))) (Fixed<or> main (Fixed<let> () (gen ocomp DATA) (gen ocomp GLOBAL vnam) (gen ocomp DEFLABEL vnam) (gen ocomp LONG tnam) (gen ocomp TEXT)))))))))))))
[?7h[32m[?7lboot.l:517              [0m (apply (Fixed<or> (array-at (oop-at (%typecheck <selector> self) 1) (type-of (car arguments))) (<selector>-inherit (oop-at (%typecheck <selector> self) 1) (type-of (car arguments))) (oop-at (%typecheck <selector> self) 2)) arguments)
[?7h[32m[?7lcore/compiler/emit.l:509[0m (gen-definition value name comp)
[?7h[32m[?7lcore/compiler/emit.l:504[0m (Fixed<let> ((name (oop-at (%typecheck <variable> (array-at vars index)) 0)) (value (oop-at (%typecheck <variable> (array-at vars index)) 1))) (println "## defn " name) (warn name "\012") (gen-definition value name comp))
[?7h[32m[?7lcore/compiler/emit.l:503[0m (Fixed<while> (<= 0 (Fixed<set> index (- index 1))) (Fixed<let> ((name (oop-at (%typecheck <variable> (array-at vars index)) 0)) (value (oop-at (%typecheck <variable> (array-at vars index)) 1))) (println "## defn " name) (warn name "\012") (gen-definition value name comp)))
[?7h[32m[?7lcore/compiler/emit.l:500[0m (Fixed<let> ((index (array-length vars))) (Fixed<while> (<= 0 (Fixed<set> index (- index 1))) (Fixed<let> ((name (oop-at (%typecheck <variable> (array-at vars index)) 0)) (value (oop-at (%typecheck <variable> (array-at vars index)) 1))) (println "## defn " name) (warn name "\012") (gen-definition value name comp))) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))))
[?7h[32m[?7lcore/compiler/emit.l:500[0m (Fixed<let> ((comp (compiler 0))) (Fixed<let> ((index (array-length vars))) (Fixed<while> (<= 0 (Fixed<set> index (- index 1))) (Fixed<let> ((name (oop-at (%typecheck <variable> (array-at vars index)) 0)) (value (oop-at (%typecheck <variable> (array-at vars index)) 1))) (println "## defn " name) (warn name "\012") (gen-definition value name comp))) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1))))))
[?7h[32m[?7lcore/compiler/emit.l:500[0m (Fixed<let> ((vars (oop-at (%typecheck <env> env) 3))) (Fixed<let> ((comp (compiler 0))) (Fixed<let> ((index (array-length vars))) (Fixed<while> (<= 0 (Fixed<set> index (- index 1))) (Fixed<let> ((name (oop-at (%typecheck <variable> (array-at vars index)) 0)) (value (oop-at (%typecheck <variable> (array-at vars index)) 1))) (println "## defn " name) (warn name "\012") (gen-definition value name comp))) (Fixed<let> ((i 0) (_limit_ (oop-at (%typecheck <compiler> comp) 9))) (Fixed<while> (< i _limit_) (apply emit (array-at (oop-at (%typecheck <compiler> comp) 8) i)) (Fixed<set> i (+ i 1)))))))
[?7h[32m[?7lcore/compiler/emit.l:519[0m (gen-env env)
[?7h[32m[?7lcore/compiler/emit.l:517[0m (Fixed<let> ((env *globals*)) (Fixed<set> *globals* (oop-at (%typecheck <env> env) 0)) (gen-env env))
[?7h