
error: undefined variable: compiler
[32m[?7l...         [0m compiler
[?7h[32m[?7lemit-c.l:193[0m (compiler (+ 1 (<compiler>-level ocomp)))
[?7h[32m[?7lemit-c.l:190[0m (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";"))))
[?7h[32m[?7lemit-c.l:190[0m (let ((body (cddr defn))) (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";")))))
[?7h[32m[?7lemit-c.l:190[0m (let ((defn (oop-at (%typecheck <expr> self) 1))) (let ((body (cddr defn))) (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";"))))))
[?7h[32m[?7lemit-c.l:190[0m (let ((main (= (quote main) name))) (let ((defn (oop-at (%typecheck <expr> self) 1))) (let ((body (cddr defn))) (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";")))))))
[?7h[32m[?7l...         [0m (let () (let ((main (= (quote main) name))) (let ((defn (oop-at (%typecheck <expr> self) 1))) (let ((body (cddr defn))) (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";"))))))))
[?7h[32m[?7l...         [0m (let () (let () (let ((main (= (quote main) name))) (let ((defn (oop-at (%typecheck <expr> self) 1))) (let ((body (cddr defn))) (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";")))))))))
[?7h[32m[?7l...         [0m (lambda (self name ocomp) (let () (let () (let ((main (= (quote main) name))) (let ((defn (oop-at (%typecheck <expr> self) 1))) (let ((body (cddr defn))) (let ((comp (compiler (+ 1 (<compiler>-level ocomp))))) (let ((params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (let ((_list_ params)) (while _list_ (let ((param (car _list_))) (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (oop-at (%typecheck <TI32> param) 0) 2))) (set _list_ (cdr _list_))))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (let ((i 0) (_limit_ (>> max-args 2))) (while (< i _limit_) (c-indent) (println "long _arg_" i " = 0;") (set i (+ i 1))))) (let ((max-temps (<compiler>-tmp-limit comp))) (let ((i 0) (_limit_ (>> max-temps 2))) (while (< i _limit_) (c-indent) (println "long _tmp_" i " = 0;") (set i (+ i 1))))) (let ((_list_ body)) (while _list_ (let ((e (car _list_))) (gen e comp)) (set _list_ (cdr _list_)))) (let ((i 0) (_limit_ (<compiler>-pc comp))) (while (< i _limit_) (apply emit (array-at (<compiler>-asm comp) i)) (set i (+ i 1)))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";"))))))))))
[?7h[32m[?7lboot.l:552  [0m (eval (cons (Fixed<quote> lambda) (cons args (cons (cons (Fixed<quote> with-instance-accessors) (cons type body)) (Fixed<quote> ())))))
[?7h[32m[?7lboot.l:552  [0m (<selector>-add-method self type (eval (cons (Fixed<quote> lambda) (cons args (cons (cons (Fixed<quote> with-instance-accessors) (cons type body)) (Fixed<quote> ()))))))
[?7h[32m[?7lboot.l:517  [0m (apply (Fixed<or> (array-at (oop-at (%typecheck <selector> self) 1) (type-of (car arguments))) (<selector>-inherit (oop-at (%typecheck <selector> self) 1) (type-of (car arguments))) (oop-at (%typecheck <selector> self) 2)) arguments)
[?7h[32m[?7lemit-c.l:189[0m (add-method gen-definition <expr> (Fixed<quote> (self name ocomp)) (Fixed<quote> ((let* ((main (= (quote main) name)) (defn (<expr>-defn self)) (body (cddr defn)) (comp (compiler (+ 1 (<compiler>-level ocomp)))) (params (map-with gen-param (cadr defn) comp))) (print "long " name "(") (let ((first 1)) (list-do param params (and (not first) (print ", ")) (set first ()) (print "long _param_" (>> (<TI32>-offset param) 2)))) (println ") {") (set *c-indent* 1) (c-indent) (println "long _eax = 0;") (let ((max-args (<compiler>-arg-limit comp))) (for (i 0 (>> max-args 2)) (c-indent) (println "long _arg_" i " = 0;"))) (let ((max-temps (<compiler>-tmp-limit comp))) (for (i 0 (>> max-temps 2)) (c-indent) (println "long _tmp_" i " = 0;"))) (list-do e body (gen e comp)) (for (i 0 (<compiler>-pc comp)) (apply emit (array-at (<compiler>-asm comp) i))) (and (<compiler>-epilogue comp) (let () (println (<compiler>-epilogue comp) ":") (c-indent))) (println "return _eax;") (set *c-indent* 0) (println "}") (println) (or main (println "long " name " = (long)" name ";"))))))
[?7h[32m[?7lboot.l:996  [0m (eval expr)
[?7h[32m[?7lboot.l:996  [0m (Fixed<let> ((result (eval expr))) (Fixed<and> (> (verbose) 1) (println "=> " result)) result)
[?7h[32m[?7lboot.l:1007 [0m (pval expr)
[?7h[32m[?7lboot.l:1007 [0m (Fixed<let> ((expr (car _list_))) (pval expr))
[?7h[32m[?7lboot.l:1007 [0m (Fixed<while> _list_ (Fixed<let> ((expr (car _list_))) (pval expr)) (Fixed<set> _list_ (cdr _list_)))
[?7h[32m[?7lboot.l:1007 [0m (Fixed<let> ((_list_ exps)) (Fixed<while> _list_ (Fixed<let> ((expr (car _list_))) (pval expr)) (Fixed<set> _list_ (cdr _list_))))
[?7h[32m[?7lboot.l:1005 [0m (Fixed<let> ((exps (find-and-read name))) (Fixed<or> exps (error "file not found or empty: " name)) (Fixed<let> ((_list_ exps)) (Fixed<while> _list_ (Fixed<let> ((expr (car _list_))) (pval expr)) (Fixed<set> _list_ (cdr _list_)))))
[?7h[32m[?7lboot.l:1015 [0m (load name)
[?7h[32m[?7lboot.l:1013 [0m (Fixed<let> () (Fixed<set> *loaded* (cons name *loaded*)) (load name))
[?7h[32m[?7lboot.l:1012 [0m (Fixed<or> (member? name *loaded*) (Fixed<let> () (Fixed<set> *loaded* (cons name *loaded*)) (load name)))
[?7h[32m[?7ltest-c-working.l:10[0m (require "emit-c.l")
[?7h